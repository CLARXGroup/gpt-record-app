<!DOCTYPE html>
<html>
<head>
    <title>ã‚¨ãƒŠã‚¬ãƒ»SAPPOROæ”¯æ´è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ  v3.5</title>
    <meta charset="utf-8">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ“</text></svg>">
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #00bcd4 0%, #26c6da 50%, #4dd0e1 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(45deg, #00838f, #0097a7);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .form-section {
            padding: 40px;
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.3s ease;
        }
        textarea:focus {
            outline: none;
            border-color: #00bcd4;
            box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.1);
        }
        .btn {
            background: linear-gradient(45deg, #00838f, #0097a7);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
            font-weight: 600;
            display: block;
            margin: 20px auto;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #00bcd4;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #00bcd4;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .instructions {
            background: #e8f6f3;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #27ae60;
        }
        .instructions h3 {
            margin-top: 0;
            color: #27ae60;
            font-weight: bold;
        }
        .instructions p {
            color: #2c3e50;
            font-weight: 500;
        }
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .warning-box h4 {
            color: #d68910;
            margin-top: 0;
        }
        .alert-box {
            background: #ffebee;
            border: 2px solid #f44336;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .alert-box h4 {
            color: #d32f2f;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ã‚¨ãƒŠã‚¬ãƒ»SAPPORO</h1>
            <p>æ”¯æ´è¨˜éŒ²è£œåŠ©ã‚·ã‚¹ãƒ†ãƒ  v3.5</p>
        </div>
        
        <div class="form-section">
            <div class="instructions">
                <h3>ğŸ“‹ ä½¿ç”¨æ–¹æ³•</h3>
                <p><strong>1. LINEã®ã‚„ã‚Šå–ã‚Šã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„</strong></p>
                <p style="margin-left: 15px;">â–¶ æ”¯æ´è¨˜éŒ²ã‚’ä½œæˆã—ãŸã„æ—¥ä»˜ã®ã€ä½œæ¥­é–‹å§‹ï½ä½œæ¥­çµ‚äº†ã¾ã§ã®å…¨LINEã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
                <p style="margin-left: 15px;">â–¶ æ—¥ä»˜ãƒ»æ™‚é–“ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã‚’ã—ã¦ãã ã•ã„ã€‚èª¤ã£ã¦å‰æ—¥åˆ†ã‚„ã€å½“æ—¥é€”ä¸­åˆ†ã®åˆ†ã‚’è²¼ã‚Šä»˜ã‘ãŸ<br>ã€€ã€€å ´åˆã€æ­£ã—ããªã„çµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</p>
                
                <p><strong>2. ã€Œæ”¯æ´è¨˜éŒ²ã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</strong></p>
                
                <p><strong>3. ç”Ÿæˆã•ã‚ŒãŸè¨˜éŒ²ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã”åˆ©ç”¨ãã ã•ã„</strong></p>
                <p style="margin-left: 15px;">â–¶ ã‚ãã¾ã§ã‚‚å…¥åŠ›è£œåŠ©ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚èª¤ã‚ŠãŒãªã„ã‹ã‚’å¿…ãšãƒã‚§ãƒƒã‚¯ã—ã€ä¸é©åˆ‡ãªè¡¨ç¾ã‚„èª¤ã£ãŸ<br>ã€€ã€€çµæœãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€ã«ã¤ã„ã¦ã¯ã€æ‰‹å‹•ã§ç›´ã—ã¦ã‹ã‚‰knowbeã¸è¨˜éŒ²ã—ã¦ãã ã•ã„</p>
            </div>
            
            <div class="form-group">
                <label for="lineData">LINEãƒ‡ãƒ¼ã‚¿å…¥åŠ›:</label>
                <textarea id="lineData" placeholder="LINEã®ã‚„ã‚Šå–ã‚Šã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„...

ä¾‹:
2025-06-20 09:59 åˆ©ç”¨è€…å ï¼‘ï¼æ™‚ã«ä½œæ¥­å§‹ã‚ã¾ã™ ä½“èª¿è‰¯ã§ã™
2025-06-20 10:10 æ”¯æ´å“¡å ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼ï¼..."></textarea>
            </div>
            
            <button class="btn" onclick="generateRecord()">ğŸ“ æ”¯æ´è¨˜éŒ²ã‚’ç”Ÿæˆ</button>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ”¯æ´è¨˜éŒ²ã‚’ç”Ÿæˆä¸­...</p>
            </div>
            
            <div id="result" class="result" style="display: none;">
                <h3>âœ… ç”Ÿæˆã•ã‚ŒãŸæ”¯æ´è¨˜éŒ²</h3>
                <div id="recordOutput"></div>
                <button class="btn" onclick="copyResult()" style="margin-top: 15px;">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
            </div>
        </div>
    </div>

    <script>
        console.log("ã‚¨ãƒŠã‚¬ãƒ»SAPPOROæ”¯æ´è¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ  v3.5 é–‹å§‹");
        
        // OpenAI APIã‚­ãƒ¼ã¯å«ã‚ã¾ã›ã‚“ï¼ˆç’°å¢ƒå¤‰æ•°ã§å®‰å…¨ã«ç®¡ç†äºˆå®šï¼‰

        
        // åˆ©ç”¨è€…ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆå®Œå…¨ç‰ˆï¼‰
        const userWorkData = {
            'ç†±ç”°æ”¿ç¾': ['è»½ä½œæ¥­ï¼ˆå°ç­’ä½œæˆï¼‰'],
            'é˜¿éƒ¨æ™ºç¾': ['è»½ä½œæ¥­ï¼ˆQRã‚³ãƒ¼ãƒ‰åˆ‡ã‚Šè²¼ã‚Šï¼‰'],
            'åµå¾äºœ': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ååˆº'],
            'ç¨²ç”°çœŸå¼“': ['ãƒãƒ©ã‚·ä½œæˆ', 'è»½ä½œæ¥­ï¼ˆæŠ˜ã‚Šç´™ï¼‰'],
            'å¤§å†…ã•ãˆå­': ['ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰ï¼ˆåˆºã—å­ï¼‰'],
            'å¤§å†…é“ä»£': ['ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰ï¼ˆåˆºã—å­ï¼‰'],
            'å°å€‰è‚²ä»£': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸'],
            'å°å¹¡æ–‡å‰‡': ['è»½ä½œæ¥­ï¼ˆQRã‚³ãƒ¼ãƒ‰åˆ‡ã‚Šè²¼ã‚Šï¼‰'],
            'æ²³é‡æœ‰é¦™': ['è»½ä½œæ¥­ï¼ˆå°ç­’ä½œæˆï¼‰', 'è»½ä½œæ¥­ï¼ˆQRã‚³ãƒ¼ãƒ‰åˆ‡ã‚Šè²¼ã‚Šï¼‰'],
            'å…ç‰äº¬å­': ['è»½ä½œæ¥­ï¼ˆæŠ˜ã‚Šç´™ï¼‰'],
            'å°å‘ç²å¤¢': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸'],
            'ç´ºè°·å…‰æ¨¹': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸'],
            'ä½ã€…æœ¨å¥ˆèœ': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸', 'è»½ä½œæ¥­ï¼ˆæŠ˜ã‚Šç´™ï¼‰'],
            'ç™½é³¥å’Œé¦™èœ': ['è»½ä½œæ¥­ï¼ˆQRã‚³ãƒ¼ãƒ‰åˆ‡ã‚Šè²¼ã‚Šï¼‰'],
            'éˆ´æœ¨å¿ƒæ›–': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸', 'è»½ä½œæ¥­ï¼ˆæŠ˜ã‚Šç´™ï¼‰', 'æ¶ˆã—ã‚´ãƒ ãƒãƒ³ã‚³', 'æ¨¡é€ ç´™'],
            'é«™æ©‹æ¸…å­': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸', 'è»½ä½œæ¥­ï¼ˆæŠ˜ã‚Šç´™ï¼‰', 'è¦³è‘‰æ¤ç‰©æ ½åŸ¹'],
            'é«˜æ©‹ç¯€å­': ['è»½ä½œæ¥­ï¼ˆæŠ˜ã‚Šç´™ï¼‰'],
            'åƒæ£’ç¥å¥ˆ': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸'],
            'å ¤äº¬å­': ['ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰ï¼ˆç·¨ã¿ç‰©ï¼‰'],
            'æ¤¿ä¸‰å’Œ': ['ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰ï¼ˆåˆºã—å­ï¼‰'],
            'é•·å†…ç”±ç¾': ['ãƒãƒ©ã‚·ä½œæˆ', 'è»½ä½œæ¥­ï¼ˆæŠ˜ã‚Šç´™ï¼‰'],
            'ç•‘ä¸­çœå¾': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸', 'ãƒãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ‰ï¼ˆç·¨ã¿ç‰©ï¼‰', 'è¦³è‘‰æ¤ç‰©æ ½åŸ¹'],
            'è—¤åŸè¡ç¾': ['è»½ä½œæ¥­ï¼ˆæŠ˜ã‚Šç´™ï¼‰'],
            'è“‘å³¶æµç†': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸', 'ã‚¤ãƒ©ã‚¹ãƒˆ'],
            'å®®ç”°å„ªå¥ˆ': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸'],
            'æ‘ä¸Šç¶¾': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸'],
            'æ‘ä¸Šç‘ç©‚': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸'],
            'å±±ä¸­å’ŒçœŸ': ['PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸']
        };

        const lineNameToRealName = {
            'ã¾ã•ã¿': 'ç†±ç”°æ”¿ç¾',
            'ã¨ã‚‚': 'é˜¿éƒ¨æ™ºç¾',
            'åµå¾äºœ': 'åµå¾äºœ',
            'ã•ãã‚‰': 'ç¨²ç”°çœŸå¼“',
            'å¯è¾°ã•ãˆå­': 'å¤§å†…ã•ãˆå­',
            'ã¿ã£ã¡ã‚‡ã‚“': 'å¤§å†…é“ä»£',
            'ã„ãã´ã£ã¡ã‚ƒã‚“': 'å°å€‰è‚²ä»£',
            'å°å¹¡ã€€æ–‡å‰‡': 'å°å¹¡æ–‡å‰‡',
            'ã“ã†ã®ã‚†ã‹': 'æ²³é‡æœ‰é¦™',
            'äº¬å­': 'å…ç‰äº¬å­',
            'rimu': 'å°å‘ç²å¤¢',
            'è°· ã²ã‚ã—': 'ç´ºè°·å…‰æ¨¹',
            'n..': 'ä½ã€…æœ¨å¥ˆèœ',
            'Waka': 'ç™½é³¥å’Œé¦™èœ',
            'å¿ƒæ›–': 'éˆ´æœ¨å¿ƒæ›–',
            'é«˜æ©‹': 'é«™æ©‹æ¸…å­',
            'é«˜æ©‹ç¯€å­': 'é«˜æ©‹ç¯€å­',
            'ã´ãƒ¼': 'åƒæ£’ç¥å¥ˆ',
            'å ¤ã€€äº¬å­': 'å ¤äº¬å­',
            'ã¿ã‚': 'æ¤¿ä¸‰å’Œ',
            'é•·å†…ç”±ç¾': 'é•·å†…ç”±ç¾',
            'ã—ã‚‡ã†': 'ç•‘ä¸­çœå¾',
            'ã‚µã‚¯ãƒ©ğŸŒ¸ğŸŒ¸': 'è—¤åŸè¡ç¾',
            'eri': 'è“‘å³¶æµç†',
            'ã‚†ã†': 'å®®ç”°å„ªå¥ˆ',
            'ç¶¾': 'æ‘ä¸Šç¶¾',
            'ç‘ç©‚': 'æ‘ä¸Šç‘ç©‚',
            'KAZUMA': 'å±±ä¸­å’ŒçœŸ'
        };

        const staffNameMap = {
            'ãˆã˜ã¾': 'æ±Ÿå³¶',
            'ã‚ˆã“ã¯ã¾': 'æ¨ªæ¿±', 
            'ãŠãŠãã¼': 'å¤§ä¹…ä¿'
        };

        // Claude APIå‘¼ã³å‡ºã—é–¢æ•°
        async function callClaudeAPI(prompt) {
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': CLAUDE_API_KEY,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-5-haiku-20241022',
                    max_tokens: 200,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        // åˆ©ç”¨è€…ç‰¹å®š
        function identifyUser(lineData) {
            if (lineData.includes('ç‘ç©‚')) return 'æ‘ä¸Šç‘ç©‚';
            
            for (const [lineName, realName] of Object.entries(lineNameToRealName)) {
                if (lineData.includes(lineName)) return realName;
            }
            
            return null;
        }

        // æ—¥ä»˜æŠ½å‡º
        function extractDates(lineData) {
            const dateMatches = lineData.match(/(\d{4}-\d{2}-\d{2})/g);
            return dateMatches ? [...new Set(dateMatches)].sort() : [];
        }

        // ä½“èª¿åˆ¤å®š
        function determineHealthStatus(lineData) {
            if (/é ­ç—›.*?å€¦æ€ æ„Ÿ|å€¦æ€ æ„Ÿ.*?é ­ç—›/i.test(lineData)) return 'é ­ç—›';
            if (/ä½“èª¿.*?æ˜¨æ—¥ã‚ˆã‚Š.*?è‰¯|ä½“èª¿.*?è‰¯ããªã£/i.test(lineData)) return 'è‰¯å¥½';
            if (/ç–²åŠ´|ãƒãƒ†/i.test(lineData)) return 'ç–²åŠ´';
            return 'æ™®é€š';
        }

        // æ™‚é–“æŠ½å‡º
        function extractWorkTimes(lineData, targetDate) {
            const lines = lineData.split('\n');
            const dayLines = lines.filter(line => line.includes(targetDate));
            
            let startTime = '10:00';
            let endTime = '15:00';
            
            for (const line of dayLines) {
                const timeMatch = line.match(/(\d{2}):(\d{2})/);
                if (!timeMatch) continue;
                
                const time = `${timeMatch[1]}:${timeMatch[2]}`;
                
                if (/ä½œæ¥­é–‹å§‹|å‚åŠ ã—ã¾ã™/i.test(line)) startTime = time;
                if (/çµ‚äº†|ãŠç–²ã‚Œ/i.test(line)) endTime = time;
            }
            
            return { startTime, endTime };
        }

        // ã‚¹ã‚¿ãƒƒãƒ•æŠ½å‡º
        function extractStaff(lineData) {
            for (const [key, value] of Object.entries(staffNameMap)) {
                if (lineData.includes(key)) return value;
            }
            return 'è·å“¡';
        }

        // æ›œæ—¥å–å¾—
        function getDayOfWeek(dateStr) {
            const date = new Date(dateStr);
            const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            return days[date.getDay()];
        }

        // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½œæˆ
        function createPrompt(lineData, phase, userName) {
            return `ä»¥ä¸‹ã®LINEã‚„ã‚Šå–ã‚Šã‹ã‚‰ã€ç¦ç¥‰æ”¯æ´è¨˜éŒ²ã®ã€Œ${phase}ã€éƒ¨åˆ†ã‚’è‡ªç„¶ãªæ—¥æœ¬èªã§ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ã€åˆ©ç”¨è€…ã€‘${userName}
ã€LINEãƒ‡ãƒ¼ã‚¿ã€‘
${lineData}

ã€è¦ä»¶ã€‘
- ${phase === 'start' ? 'é–‹å§‹é€£çµ¡' : phase === 'work' ? 'ä½œæ¥­ä¸­é€£çµ¡' : 'çµ‚äº†é€£çµ¡'}ã®å†…å®¹ã®ã¿
- å®Ÿéš›ã®ã‚„ã‚Šå–ã‚Šã‚’åæ˜ 
- å®¢è¦³çš„ã§é©åˆ‡ãªè¡¨ç¾
- 100æ–‡å­—ç¨‹åº¦

å®Ÿéš›ã®ç™ºè¨€å†…å®¹ã‚’åˆ†æã—ã¦è¨˜éŒ²ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚`;
        }

        // ãƒ¡ã‚¤ãƒ³å‡¦ç†
        async function generateRecord() {
            const lineData = document.getElementById('lineData').value.trim();
            
            if (!lineData) {
                alert('LINEãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            
            setTimeout(async () => {
                try {
                    const userName = identifyUser(lineData);
                    if (!userName) {
                        throw new Error('åˆ©ç”¨è€…ã‚’ç‰¹å®šã§ãã¾ã›ã‚“ã§ã—ãŸ');
                    }
                    
                    const dates = extractDates(lineData);
                    const healthStatus = determineHealthStatus(lineData);
                    const staff = extractStaff(lineData);
                    
                    let warningHtml = '';
                    if (/ä¸­æ–­.*?ã•ã›ã¦|é ­ç—›.*?å€¦æ€ æ„Ÿ/i.test(lineData)) {
                        warningHtml = `
                            <div class="alert-box">
                                <h4>ğŸš¨ æ¬ å¸­æ™‚å¯¾å¿œåŠ ç®—ã®å¯èƒ½æ€§</h4>
                                <p>ä½“èª¿ä¸è‰¯ã«ã‚ˆã‚‹ä½œæ¥­ä¸­æ–­ãƒ»æ¬ å¸­ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚</p>
                            </div>
                        `;
                    }
                    
                    let recordsHtml = '';
                    const targetDates = dates.length > 0 ? dates : [new Date().toISOString().split('T')[0]];
                    
                    for (const date of targetDates) {
                        const dayOfWeek = getDayOfWeek(date);
                        const times = extractWorkTimes(lineData, date);
                        
                        let startDesc, workDesc, endDesc;
                        
                        try {
                            startDesc = await callClaudeAPI(createPrompt(lineData, 'start', userName));
                            workDesc = await callClaudeAPI(createPrompt(lineData, 'work', userName));
                            endDesc = await callClaudeAPI(createPrompt(lineData, 'end', userName));
                        } catch (error) {
                            // APIå¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                            startDesc = 'æœ¬äººã‚ˆã‚Šä½œæ¥­é–‹å§‹ã®å ±å‘ŠãŒã‚ã£ãŸã€‚æ”¯æ´å“¡ã‚ˆã‚Šé©åˆ‡ãªå£°ã‹ã‘ã‚’å®Ÿæ–½ã€‚';
                            workDesc = 'æ”¯æ´ä¸­ã®ç‰¹æ®µã®é€£çµ¡ã¯ãªãã€å®‰å®šã—ãŸä½œæ¥­é€²è¡ŒãŒç¶™ç¶šã•ã‚ŒãŸã¨åˆ¤æ–­ã•ã‚Œã‚‹ã€‚';
                            endDesc = 'æœ¬äººã‚ˆã‚Šä½œæ¥­çµ‚äº†ã®å ±å‘ŠãŒã‚ã£ãŸã€‚æ”¯æ´å“¡ã‚ˆã‚ŠåŠ´ã„ã®è¨€è‘‰ã‚’å®Ÿæ–½ã€‚';
                        }
                        
                        recordsHtml += `
                            <div style="margin-bottom: 25px; padding: 15px; border-left: 4px solid #00bcd4; background: white;">
                                <p><strong>âœ… ${date}ï¼ˆ${dayOfWeek}ï¼‰${userName} æ”¯æ´è¨˜éŒ²</strong></p>
                                <p><strong>é€šæ‰€åŒºåˆ†ï¼š</strong>é€šæ‰€</p>
                                <p><strong>ä½œæ¥­æ™‚é–“ï¼š</strong>${times.startTime} ï½ ${times.endTime}</p>
                                <p><strong>ä½œæ¥­å†…å®¹ï¼š</strong>PCä½œæ¥­ï¼ˆãƒ‡ãƒ¼ã‚¿å…¥åŠ›ï¼‰ç´å“æ›¸</p>
                                <p><strong>åˆ©ç”¨è€…çŠ¶æ³ï¼š</strong>ä½“èª¿ï¼š${healthStatus}ï¼æœ¬äººã‹ã‚‰ä½“èª¿ã«ã¤ã„ã¦å ±å‘ŠãŒã‚ã£ãŸã€‚</p>
                                
                                <p style="margin-top: 15px;"><strong>â€»knowbeã®ä»•æ§˜ä¸Šã€é€šæ‰€ã€‘è¡¨è¨˜ã ãŒã€ã€åœ¨å®…ã€‘ã«ã¦æ”¯æ´å®Ÿæ–½</strong></p>
                                
                                <p><strong>â– é–‹å§‹é€£çµ¡</strong> ${times.startTime}ï¼» é€£çµ¡æ‰‹æ®µï¼šLINE ï¼ å¯¾å¿œè·å“¡ï¼š${staff} ï¼½<br>
                                ${startDesc}</p>
                                
                                <p><strong>â– ä½œæ¥­ä¸­é€£çµ¡</strong><br>
                                ${workDesc}</p>
                                
                                <p><strong>â– çµ‚äº†é€£çµ¡</strong> ${times.endTime}ï¼» é€£çµ¡æ‰‹æ®µï¼šLINE ï¼ å¯¾å¿œè·å“¡ï¼š${staff} ï¼½<br>
                                ${endDesc}</p>
                            </div>
                        `;
                    }
                    
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('result').style.display = 'block';
                    
                    document.getElementById('recordOutput').innerHTML = warningHtml + `
                        <div style="font-family: 'MS Gothic', monospace; font-size: 14px; line-height: 1.6;">
                            <h3>${userName}ã•ã‚“ æ”¯æ´è¨˜éŒ²</h3>
                            ${recordsHtml}
                        </div>
                    `;
                    
                } catch (error) {
                    document.getElementById('loading').style.display = 'none';
                    alert(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
                }
            }, 1500);
        }
        
        function copyResult() {
            const resultDiv = document.getElementById('recordOutput');
            const textContent = resultDiv.textContent || resultDiv.innerText;
            
            navigator.clipboard.writeText(textContent).then(() => {
                alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = textContent;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            });
        }
    </script>
</body>
</html>